<html>
    <head>
        <script>MathJax = {
            loader: {
                load: ['[custom]/xypic.js'],
                paths: {custom: 'https://cdn.jsdelivr.net/gh/sonoisa/XyJax-v3@3.0.1/build/'}
            },
            startup : { typeset : false },
            tex : { inlineMath : [['$','$']], packages: {'[+]': ['xypic']}}
        };
        </script>
        <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
        <script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
        <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
    <title>Math Note</title>
</head>
<body style='font-family: "Times New Roman", "YuMincho", "Hiragino Mincho ProN", "Yu Mincho", "MS PMincho", serif;'>

<div id="editor" contenteditable="true" hidden="true" style="border: 1px solid #aaa;" ondblclick="toView();"></div>
<div id="screen" hidden="true" ondblclick="toEdit();"></div>
<script>
    const storage = localStorage;

    const editor = (function() {
        const context = document.getElementById("editor");
        context.oninput = function(e) { 
            storage.setItem(sheet, context.innerHTML);
        };
        context.onkeypress = function(e) {
            if(e.key == 'Enter' && e.shiftKey) {
                toView();
                context.blur();
            }
        }
        return {
            show : function() {
                context.innerText = storage.getItem(sheet);
                context.hidden = false;
            },
            hide : function() {
                storage.setItem(sheet, context.innerText);
                context.innerHTML = '';
                context.hidden = true;
            }
        };
    })();

    const screen = (function() {
        const context = document.getElementById("screen");
        return {
            show : function() {
                context.innerHTML = marked.parse(storage.getItem(sheet));
                MathJax.typesetPromise().then(() => context.hidden = false);
            },
            hide : function() {
                context.innerHTML = '';
                context.hidden = true;
            }
        }
    })();
 
    let sheet = "1";

    document.addEventListener('DOMContentLoaded', () => editor.show());

    function toEdit() { screen.hide(); editor.show(); }
    function toView() { editor.hide(); screen.show(); }
</script>
</body>
</html>